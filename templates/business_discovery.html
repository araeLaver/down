<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자동 사업 발굴 시스템 - Qhyx Inc.</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .stats-card {
            border-left: 4px solid #667eea;
            transition: transform 0.2s;
        }
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .business-card {
            border-left: 4px solid #28a745;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }
        .business-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            transform: translateX(5px);
        }
        .score-badge {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .score-high { color: #28a745; }
        .score-medium { color: #ffc107; }
        .score-low { color: #dc3545; }
        .discovery-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .filter-buttons .btn {
            margin: 5px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="container">
            <h1><i class="fas fa-robot"></i> 자동 IT 사업 발굴 시스템</h1>
            <p class="lead">24/7 실시간 시장 분석 • 80점 이상만 선별 • 즉시 실행 가능</p>
        </div>
    </div>

    <div class="container">
        <!-- 통계 카드 -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <i class="fas fa-lightbulb fa-3x text-warning mb-3"></i>
                        <h3 id="stat-total">0</h3>
                        <p class="text-muted">총 발굴</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <i class="fas fa-calendar-day fa-3x text-primary mb-3"></i>
                        <h3 id="stat-today">0</h3>
                        <p class="text-muted">오늘 발굴</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <i class="fas fa-calendar-week fa-3x text-info mb-3"></i>
                        <h3 id="stat-week">0</h3>
                        <p class="text-muted">이번 주</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <i class="fas fa-star fa-3x text-success mb-3"></i>
                        <h3 id="stat-highscore">0</h3>
                        <p class="text-muted">고득점 (85+)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 필터 버튼 -->
        <div class="filter-buttons mb-3">
            <button class="btn btn-primary" onclick="filterBusinesses('all')">전체</button>
            <button class="btn btn-success" onclick="filterBusinesses('high')">고득점 (85+)</button>
            <button class="btn btn-warning" onclick="filterBusinesses('medium')">중간 (80-84)</button>
            <button class="btn btn-info" onclick="sortBusinesses('date')">최신순</button>
            <button class="btn btn-info" onclick="sortBusinesses('score')">점수순</button>
        </div>

        <!-- 발굴된 사업 목록 -->
        <div class="row">
            <div class="col-12">
                <h3 class="mb-3">
                    <i class="fas fa-list"></i> 발굴된 IT 사업 아이디어
                    <span class="badge bg-primary" id="business-count">0</span>
                </h3>
                <div id="business-list">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">로딩 중...</span>
                        </div>
                        <p class="mt-3">사업 아이디어 로딩 중...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 실시간 발굴 상태 -->
    <div class="discovery-status" id="discovery-status">
        <div class="d-flex align-items-center">
            <div class="spinner-grow spinner-grow-sm text-success me-2 pulse" role="status"></div>
            <span><strong>실시간 발굴 중</strong></span>
        </div>
        <small class="text-muted" id="last-update">마지막 업데이트: -</small>
    </div>

    <!-- Business Detail Modal -->
    <div class="modal fade" id="businessModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">사업 상세</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- 동적 내용 -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let allBusinesses = [];
        let currentFilter = 'all';

        // 데이터 로드
        async function loadBusinesses() {
            try {
                const response = await fetch('/api/discovered-businesses');
                const data = await response.json();

                allBusinesses = data.businesses;

                // 통계 업데이트
                document.getElementById('stat-total').textContent = data.stats.total;
                document.getElementById('stat-today').textContent = data.stats.today;
                document.getElementById('stat-week').textContent = data.stats.this_week;
                document.getElementById('stat-highscore').textContent = data.stats.high_score;

                // 목록 표시
                displayBusinesses(allBusinesses);

                // 마지막 업데이트 시간
                document.getElementById('last-update').textContent =
                    `마지막 업데이트: ${new Date().toLocaleString('ko-KR')}`;

            } catch (error) {
                console.error('Error loading businesses:', error);
                document.getElementById('business-list').innerHTML =
                    '<div class="alert alert-danger">데이터 로딩 실패. 새로고침 해주세요.</div>';
            }
        }

        // 사업 목록 표시
        function displayBusinesses(businesses) {
            const container = document.getElementById('business-list');
            document.getElementById('business-count').textContent = businesses.length;

            if (businesses.length === 0) {
                container.innerHTML = '<div class="alert alert-info">발굴된 사업이 없습니다.</div>';
                return;
            }

            let html = '';

            businesses.forEach(biz => {
                const scoreClass = biz.score >= 85 ? 'score-high' :
                                 biz.score >= 80 ? 'score-medium' : 'score-low';

                const monthlyRevenue = biz.details.estimated_monthly_revenue || 0;
                const roi = biz.revenue_12m && biz.investment ?
                    ((biz.revenue_12m - biz.investment) / biz.investment * 100).toFixed(0) : 0;

                html += `
                    <div class="card business-card" data-score="${biz.score}">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-2 text-center">
                                    <div class="score-badge ${scoreClass}">
                                        ${biz.score}
                                    </div>
                                    <small class="text-muted">점수</small>
                                </div>
                                <div class="col-md-7">
                                    <h5 class="card-title mb-1">
                                        <i class="fas fa-rocket text-primary"></i>
                                        ${biz.name}
                                    </h5>
                                    <p class="text-muted mb-2">${biz.description || ''}</p>
                                    <div class="d-flex gap-2">
                                        <span class="badge bg-info">${biz.type}</span>
                                        <span class="badge bg-secondary">${biz.revenue_model}</span>
                                        <span class="badge bg-${biz.priority === 'high' ? 'success' : 'warning'}">
                                            ${biz.priority}
                                        </span>
                                    </div>
                                </div>
                                <div class="col-md-3 text-end">
                                    <p class="mb-1">
                                        <strong>월 수익:</strong><br>
                                        <span class="text-success">${monthlyRevenue.toLocaleString()}원</span>
                                    </p>
                                    <p class="mb-1">
                                        <strong>ROI:</strong>
                                        <span class="text-primary">${roi}%</span>
                                    </p>
                                    <small class="text-muted">${biz.created_at}</small><br>
                                    <button class="btn btn-sm btn-primary mt-2" onclick="showDetail(${biz.id})">
                                        상세보기
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // 필터링
        function filterBusinesses(filter) {
            currentFilter = filter;
            let filtered = allBusinesses;

            if (filter === 'high') {
                filtered = allBusinesses.filter(b => b.score >= 85);
            } else if (filter === 'medium') {
                filtered = allBusinesses.filter(b => b.score >= 80 && b.score < 85);
            }

            displayBusinesses(filtered);
        }

        // 정렬
        function sortBusinesses(sortBy) {
            let sorted = [...allBusinesses];

            if (sortBy === 'score') {
                sorted.sort((a, b) => b.score - a.score);
            } else if (sortBy === 'date') {
                sorted.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
            }

            allBusinesses = sorted;
            filterBusinesses(currentFilter);
        }

        // 상세보기
        function showDetail(bizId) {
            const biz = allBusinesses.find(b => b.id === bizId);
            if (!biz) return;

            document.getElementById('modalTitle').innerHTML =
                `<i class="fas fa-rocket text-primary"></i> ${biz.name}`;

            const monthlyRevenue = biz.details.estimated_monthly_revenue || 0;
            const roi = biz.revenue_12m && biz.investment ?
                ((biz.revenue_12m - biz.investment) / biz.investment * 100).toFixed(0) : 0;

            document.getElementById('modalBody').innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-chart-line"></i> 점수 및 평가</h6>
                        <ul class="list-unstyled">
                            <li><strong>종합 점수:</strong> ${biz.score}/100</li>
                            <li><strong>실현 가능성:</strong> ${biz.feasibility}/10</li>
                            <li><strong>위험도:</strong> ${biz.risk}</li>
                            <li><strong>우선순위:</strong> ${biz.priority}</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-money-bill-wave"></i> 수익성</h6>
                        <ul class="list-unstyled">
                            <li><strong>초기 투자:</strong> ${(biz.investment || 0).toLocaleString()}원</li>
                            <li><strong>예상 월 수익:</strong> ${monthlyRevenue.toLocaleString()}원</li>
                            <li><strong>연간 예상:</strong> ${(biz.revenue_12m || 0).toLocaleString()}원</li>
                            <li><strong>ROI:</strong> ${roi}%</li>
                        </ul>
                    </div>
                </div>
                <hr>
                <h6><i class="fas fa-info-circle"></i> 사업 설명</h6>
                <p>${biz.description}</p>
                <hr>
                <h6><i class="fas fa-cog"></i> 기술 정보</h6>
                <ul class="list-unstyled">
                    <li><strong>사업 유형:</strong> ${biz.details.business_type || '-'}</li>
                    <li><strong>수익 모델:</strong> ${biz.revenue_model}</li>
                    <li><strong>발굴 키워드:</strong> ${biz.details.market_keyword || '-'}</li>
                </ul>
                <div class="alert alert-success">
                    <i class="fas fa-lightbulb"></i>
                    ${biz.details.priority_reason || '자동 발굴된 유망 사업입니다.'}
                </div>
            `;

            new bootstrap.Modal(document.getElementById('businessModal')).show();
        }

        // 자동 새로고침 (5분마다)
        setInterval(() => {
            loadBusinesses();
        }, 300000);

        // 초기 로드
        loadBusinesses();
    </script>
</body>
</html>
