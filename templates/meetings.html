<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“‹ íšŒì˜ ë³´ê³ ì„œ - Qhyx Inc.</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #4CAF50;
            --warning-color: #ff9800;
            --info-color: #2196F3;
        }

        body {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }

        .main-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        /* í†µê³„ ì¹´ë“œ */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* í•„í„° ë° ê²€ìƒ‰ */
        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .filter-tab {
            padding: 10px 20px;
            border: none;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .filter-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .filter-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 45px 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1rem;
        }

        .search-box i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        /* íšŒì˜ íƒ€ì…ë³„ ìƒ‰ìƒ */
        .meeting-type-ì „ëµ { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .meeting-type-ì‚¬ì—… { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .meeting-type-ì œí’ˆ { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .meeting-type-ë§ˆì¼€íŒ… { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .meeting-type-ì¬ë¬´ { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .meeting-type-ê¸°ìˆ  { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
        .meeting-type-ë¶„ì„ { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .meeting-type-default { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }

        /* íšŒì˜ ì¹´ë“œ */
        .meetings-grid {
            display: grid;
            gap: 20px;
        }

        .meeting-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
        }

        .meeting-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .meeting-header {
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .meeting-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0;
        }

        .meeting-date {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .meeting-badge {
            background: rgba(255,255,255,0.3);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .meeting-body {
            padding: 20px;
        }

        .info-section {
            margin-bottom: 20px;
        }

        .info-section h6 {
            color: #333;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-section h6 i {
            color: var(--primary-color);
        }

        .info-item {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
            border-left: 3px solid var(--primary-color);
        }

        .info-item.decision {
            border-left-color: var(--success-color);
            background: #e8f5e9;
        }

        .info-item.action {
            border-left-color: var(--warning-color);
            background: #fff8e1;
        }

        .expand-btn {
            width: 100%;
            padding: 10px;
            background: #f8f9fa;
            border: none;
            border-radius: 8px;
            color: var(--primary-color);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .expand-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .meeting-details {
            display: none;
            padding: 20px;
            background: #f8f9fa;
            border-top: 2px solid #e0e0e0;
        }

        .meeting-details.show {
            display: block;
        }

        .participants-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .participant-badge {
            background: var(--primary-color);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        .no-meetings {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-meetings i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 40px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .filter-tabs {
                justify-content: center;
            }

            .meeting-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="fas fa-building me-2"></i>Qhyx Inc.
            </a>
            <div class="d-flex">
                <a href="/suggestions" class="btn btn-outline-light me-2">
                    <i class="fas fa-lightbulb me-1"></i>ê±´ì˜ì‚¬í•­
                </a>
                <a href="/dashboard" class="btn btn-outline-light me-2">
                    <i class="fas fa-chart-line me-1"></i>ëŒ€ì‹œë³´ë“œ
                </a>
                <a href="/" class="btn btn-outline-light">
                    <i class="fas fa-home me-1"></i>í™ˆ
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4 mb-5">
        <div class="main-container">
            <!-- í†µê³„ ì„¹ì…˜ -->
            <h2 class="mb-4">
                <i class="fas fa-chart-bar text-primary"></i> íšŒì˜ í˜„í™©
            </h2>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" id="totalMeetings">-</div>
                    <div class="stat-label">ì´ íšŒì˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayMeetings">-</div>
                    <div class="stat-label">ì˜¤ëŠ˜ íšŒì˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalDecisions">-</div>
                    <div class="stat-label">í•µì‹¬ ê²°ì •</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalActions">-</div>
                    <div class="stat-label">ì‹¤í–‰ í•­ëª©</div>
                </div>
            </div>

            <!-- í•„í„° ë° ê²€ìƒ‰ ì„¹ì…˜ -->
            <div class="filter-section">
                <h5 class="mb-3"><i class="fas fa-filter"></i> í•„í„° ë° ê²€ìƒ‰</h5>
                <div class="filter-tabs" id="filterTabs">
                    <button class="filter-tab active" data-filter="all">
                        <i class="fas fa-globe"></i> ì „ì²´
                    </button>
                    <button class="filter-tab" data-filter="today">
                        <i class="fas fa-calendar-day"></i> ì˜¤ëŠ˜
                    </button>
                    <button class="filter-tab" data-filter="ì „ëµ">
                        <i class="fas fa-chess"></i> ì „ëµ
                    </button>
                    <button class="filter-tab" data-filter="ì‚¬ì—…">
                        <i class="fas fa-briefcase"></i> ì‚¬ì—…
                    </button>
                    <button class="filter-tab" data-filter="ì œí’ˆ">
                        <i class="fas fa-box"></i> ì œí’ˆ
                    </button>
                    <button class="filter-tab" data-filter="ë§ˆì¼€íŒ…">
                        <i class="fas fa-bullhorn"></i> ë§ˆì¼€íŒ…
                    </button>
                    <button class="filter-tab" data-filter="ì¬ë¬´">
                        <i class="fas fa-dollar-sign"></i> ì¬ë¬´
                    </button>
                    <button class="filter-tab" data-filter="ê¸°ìˆ ">
                        <i class="fas fa-code"></i> ê¸°ìˆ 
                    </button>
                </div>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="íšŒì˜ ì œëª©, ê²°ì •ì‚¬í•­, ì‹¤í–‰í•­ëª© ê²€ìƒ‰...">
                    <i class="fas fa-search"></i>
                </div>
            </div>

            <!-- íšŒì˜ ëª©ë¡ -->
            <h4 class="mb-3">
                <i class="fas fa-list"></i> íšŒì˜ ë³´ê³ ì„œ <span class="badge bg-primary" id="meetingCount">0</span>
            </h4>
            <div id="meetingsList" class="meetings-grid">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let allMeetings = [];
        let currentFilter = 'all';
        let currentSearch = '';

        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // íšŒì˜ íƒ€ì…ì—ì„œ ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ
        function getMeetingCategory(meetingType) {
            if (!meetingType) return 'default';
            if (meetingType.includes('ì „ëµ')) return 'ì „ëµ';
            if (meetingType.includes('ì‚¬ì—…') || meetingType.includes('ë°œêµ´') || meetingType.includes('í™•ì¥')) return 'ì‚¬ì—…';
            if (meetingType.includes('ì œí’ˆ') || meetingType.includes('ê°œë°œ')) return 'ì œí’ˆ';
            if (meetingType.includes('ë§ˆì¼€íŒ…')) return 'ë§ˆì¼€íŒ…';
            if (meetingType.includes('ì¬ë¬´') || meetingType.includes('í˜„í™©')) return 'ì¬ë¬´';
            if (meetingType.includes('ê¸°ìˆ ') || meetingType.includes('í˜ì‹ ')) return 'ê¸°ìˆ ';
            if (meetingType.includes('ë¶„ì„') || meetingType.includes('ê²½ìŸ')) return 'ë¶„ì„';
            return 'default';
        }

        // íšŒì˜ íƒ€ì… ì•„ì´ì½˜
        function getMeetingIcon(category) {
            const icons = {
                'ì „ëµ': 'fa-chess',
                'ì‚¬ì—…': 'fa-briefcase',
                'ì œí’ˆ': 'fa-box',
                'ë§ˆì¼€íŒ…': 'fa-bullhorn',
                'ì¬ë¬´': 'fa-dollar-sign',
                'ê¸°ìˆ ': 'fa-code',
                'ë¶„ì„': 'fa-chart-line',
                'default': 'fa-users'
            };
            return icons[category] || icons.default;
        }

        // íšŒì˜ í•„í„°ë§
        function filterMeetings() {
            let filtered = allMeetings;

            // ë‚ ì§œ í•„í„°
            if (currentFilter === 'today') {
                const today = new Date().toDateString();
                filtered = filtered.filter(m => {
                    if (!m.date) return false;
                    return new Date(m.date).toDateString() === today;
                });
            } else if (currentFilter !== 'all') {
                // ì¹´í…Œê³ ë¦¬ í•„í„°
                filtered = filtered.filter(m => {
                    const category = getMeetingCategory(m.meeting_type);
                    return category === currentFilter;
                });
            }

            // ê²€ìƒ‰ í•„í„°
            if (currentSearch) {
                const searchLower = currentSearch.toLowerCase();
                filtered = filtered.filter(m => {
                    const searchText = [
                        m.title,
                        m.meeting_type,
                        ...(m.key_decisions || []),
                        ...(m.action_items || []),
                        ...(m.agenda || [])
                    ].join(' ').toLowerCase();
                    return searchText.includes(searchLower);
                });
            }

            return filtered;
        }

        // íšŒì˜ ë Œë”ë§
        function renderMeetings() {
            const container = document.getElementById('meetingsList');
            const filtered = filterMeetings();

            document.getElementById('meetingCount').textContent = filtered.length;

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="no-meetings">
                        <i class="fas fa-calendar-times"></i>
                        <h4>íšŒì˜ê°€ ì—†ìŠµë‹ˆë‹¤</h4>
                        <p>ì„ íƒí•œ í•„í„°ì— í•´ë‹¹í•˜ëŠ” íšŒì˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            let html = '';
            filtered.forEach(meeting => {
                const category = getMeetingCategory(meeting.meeting_type);
                const icon = getMeetingIcon(category);

                html += `
                    <div class="meeting-card" data-category="${category}">
                        <div class="meeting-header meeting-type-${category}">
                            <div>
                                <div class="meeting-title">
                                    <i class="fas ${icon}"></i> ${meeting.meeting_type || 'ì¼ë°˜ íšŒì˜'}
                                </div>
                                <div class="meeting-date">
                                    <i class="fas fa-clock"></i> ${formatDate(meeting.date)}
                                </div>
                            </div>
                            <div class="meeting-badge">
                                ${meeting.status === 'completed' ? 'âœ“ ì™„ë£Œ' : 'ì§„í–‰ì¤‘'}
                            </div>
                        </div>

                        <div class="meeting-body">
                            <!-- ì£¼ìš” ì•ˆê±´ -->
                            <div class="info-section">
                                <h6><i class="fas fa-list"></i> ì£¼ìš” ì•ˆê±´ (${meeting.agenda ? meeting.agenda.length : 0}ê°œ)</h6>
                                ${meeting.agenda && meeting.agenda.length > 0 ? meeting.agenda.slice(0, 3).map((item, idx) => `
                                    <div class="info-item">${idx + 1}. ${item}</div>
                                `).join('') : '<p class="text-muted">ì•ˆê±´ ì—†ìŒ</p>'}
                                ${meeting.agenda && meeting.agenda.length > 3 ? `
                                    <small class="text-muted">+ ${meeting.agenda.length - 3}ê°œ ë”ë³´ê¸°</small>
                                ` : ''}
                            </div>

                            <!-- í•µì‹¬ ê²°ì •ì‚¬í•­ -->
                            <div class="info-section">
                                <h6><i class="fas fa-check-circle"></i> í•µì‹¬ ê²°ì •ì‚¬í•­ (${meeting.key_decisions ? meeting.key_decisions.length : 0}ê°œ)</h6>
                                ${meeting.key_decisions && meeting.key_decisions.length > 0 ? meeting.key_decisions.slice(0, 2).map((item, idx) => `
                                    <div class="info-item decision">${idx + 1}. ${item}</div>
                                `).join('') : '<p class="text-muted">ê²°ì •ì‚¬í•­ ì—†ìŒ</p>'}
                            </div>

                            <button class="expand-btn" onclick="toggleDetails(${meeting.id})">
                                <i class="fas fa-chevron-down"></i> ìƒì„¸ë³´ê¸° (ì‹¤í–‰í•­ëª© ${meeting.action_items ? meeting.action_items.length : 0}ê°œ)
                            </button>
                        </div>

                        <div class="meeting-details" id="details-${meeting.id}">
                            <!-- ì‹¤í–‰ í•­ëª© -->
                            <div class="info-section">
                                <h6><i class="fas fa-tasks"></i> ì‹¤í–‰ í•­ëª©</h6>
                                ${meeting.action_items && meeting.action_items.length > 0 ? meeting.action_items.map((item, idx) => `
                                    <div class="info-item action">${idx + 1}. ${item}</div>
                                `).join('') : '<p class="text-muted">ì‹¤í–‰í•­ëª© ì—†ìŒ</p>'}
                            </div>

                            <!-- ì „ì²´ ì•ˆê±´ -->
                            ${meeting.agenda && meeting.agenda.length > 3 ? `
                                <div class="info-section">
                                    <h6><i class="fas fa-list-ul"></i> ì „ì²´ ì•ˆê±´</h6>
                                    ${meeting.agenda.map((item, idx) => `
                                        <div class="info-item">${idx + 1}. ${item}</div>
                                    `).join('')}
                                </div>
                            ` : ''}

                            <!-- ì „ì²´ ê²°ì •ì‚¬í•­ -->
                            ${meeting.key_decisions && meeting.key_decisions.length > 2 ? `
                                <div class="info-section">
                                    <h6><i class="fas fa-clipboard-check"></i> ì „ì²´ ê²°ì •ì‚¬í•­</h6>
                                    ${meeting.key_decisions.map((item, idx) => `
                                        <div class="info-item decision">${idx + 1}. ${item}</div>
                                    `).join('')}
                                </div>
                            ` : ''}

                            <!-- ì°¸ì„ì -->
                            <div class="info-section">
                                <h6><i class="fas fa-users"></i> ì°¸ì„ì</h6>
                                <div class="participants-list">
                                    ${(() => {
                                        if (!meeting.participants || meeting.participants.length === 0) {
                                            return '<span class="text-muted">ì°¸ì„ì ì •ë³´ ì—†ìŒ</span>';
                                        }
                                        return meeting.participants.map(p => `
                                            <span class="participant-badge">${p}</span>
                                        `).join('');
                                    })()}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // ìƒì„¸ë³´ê¸° í† ê¸€
        function toggleDetails(meetingId) {
            const details = document.getElementById(`details-${meetingId}`);
            const btn = event.target.closest('.expand-btn');

            if (details.classList.contains('show')) {
                details.classList.remove('show');
                btn.innerHTML = '<i class="fas fa-chevron-down"></i> ìƒì„¸ë³´ê¸°';
            } else {
                // ë‹¤ë¥¸ ìƒì„¸ë³´ê¸° ë‹«ê¸°
                document.querySelectorAll('.meeting-details').forEach(d => d.classList.remove('show'));
                details.classList.add('show');
                btn.innerHTML = '<i class="fas fa-chevron-up"></i> ì ‘ê¸°';
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const today = new Date().toDateString();
            const todayMeetings = allMeetings.filter(m => {
                if (!m.date) return false;
                return new Date(m.date).toDateString() === today;
            });

            let totalDecisions = 0;
            let totalActions = 0;

            allMeetings.forEach(meeting => {
                totalDecisions += meeting.key_decisions ? meeting.key_decisions.length : 0;
                totalActions += meeting.action_items ? meeting.action_items.length : 0;
            });

            document.getElementById('totalMeetings').textContent = allMeetings.length;
            document.getElementById('todayMeetings').textContent = todayMeetings.length;
            document.getElementById('totalDecisions').textContent = totalDecisions;
            document.getElementById('totalActions').textContent = totalActions;
        }

        // íšŒì˜ ë°ì´í„° ë¡œë“œ
        function loadMeetings() {
            fetch('/api/meetings')
                .then(response => response.json())
                .then(data => {
                    allMeetings = data.meetings || [];
                    renderMeetings();
                    updateStats();
                })
                .catch(error => {
                    console.error('Error loading meetings:', error);
                    document.getElementById('meetingsList').innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i> íšŒì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
                        </div>
                    `;
                });
        }

        // í•„í„° íƒ­ í´ë¦­
        document.addEventListener('click', function(e) {
            if (e.target.closest('.filter-tab')) {
                const btn = e.target.closest('.filter-tab');
                currentFilter = btn.dataset.filter;

                // í™œì„±í™” ìƒíƒœ ë³€ê²½
                document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                btn.classList.add('active');

                renderMeetings();
            }
        });

        // ê²€ìƒ‰
        document.getElementById('searchInput').addEventListener('input', function(e) {
            currentSearch = e.target.value;
            renderMeetings();
        });

        // í˜ì´ì§€ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            loadMeetings();

            // 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
            setInterval(loadMeetings, 30000);
        });
    </script>
</body>
</html>
