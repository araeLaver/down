<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실시간 비즈니스 모니터링 - Qhyx</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0b;
            color: #e5e5e5;
            min-height: 100vh;
        }

        .layout {
            display: flex;
            min-height: 100vh;
            padding-top: 60px;
        }

        .sidebar {
            width: 240px;
            background: #111;
            border-right: 1px solid #222;
            position: fixed;
            top: 60px;
            left: 0;
            bottom: 0;
            padding: 1rem 0;
            overflow-y: auto;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: #888;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .sidebar-item:hover {
            color: #e5e5e5;
            background: #1a1a1b;
        }

        .sidebar-item.active {
            color: #4ade80;
            background: rgba(74, 222, 128, 0.1);
            border-left: 2px solid #4ade80;
        }

        .sidebar-item i {
            width: 20px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            margin-left: 240px;
            padding: 2rem;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
        }

        .system-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #888;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .refresh-btn {
            padding: 0.5rem 1rem;
            background: #111;
            border: 1px solid #333;
            border-radius: 8px;
            color: #e5e5e5;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .refresh-btn:hover {
            border-color: #4ade80;
            color: #4ade80;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: #111;
            border: 1px solid #222;
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            transition: all 0.2s;
        }

        .metric-card:hover {
            border-color: #333;
        }

        .metric-icon {
            font-size: 1.5rem;
            color: #4ade80;
            margin-bottom: 0.75rem;
        }

        .metric-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 0.25rem;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #888;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .card {
            background: #111;
            border: 1px solid #222;
            border-radius: 12px;
            overflow: hidden;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            border-bottom: 1px solid #222;
        }

        .card-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-title i {
            color: #4ade80;
        }

        .card-body {
            padding: 1.25rem;
        }

        .chart-container {
            height: 200px;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title i {
            color: #4ade80;
        }

        .activity-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0.75rem;
            border-left: 3px solid #4ade80;
            background: #1a1a1b;
            border-radius: 0 6px 6px 0;
            margin-bottom: 0.5rem;
        }

        .activity-content strong {
            color: #fff;
            font-size: 0.9rem;
        }

        .activity-type {
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.25rem;
        }

        .activity-meta {
            text-align: right;
        }

        .badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-success { background: rgba(74, 222, 128, 0.15); color: #4ade80; }
        .badge-primary { background: rgba(96, 165, 250, 0.15); color: #60a5fa; }
        .badge-warning { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
        .badge-info { background: rgba(129, 140, 248, 0.15); color: #818cf8; }

        .activity-time {
            font-size: 0.75rem;
            color: #666;
            margin-top: 0.25rem;
        }

        .employee-grid, .business-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .employee-card, .business-plan-card {
            background: #111;
            border: 1px solid #222;
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .employee-info h4 {
            color: #fff;
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .employee-role {
            color: #888;
            font-size: 0.85rem;
        }

        .employee-status {
            text-align: right;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-active { background: #4ade80; }
        .status-warning { background: #fbbf24; }

        .task-count {
            font-size: 0.8rem;
            color: #888;
            margin-top: 0.25rem;
        }

        .discovery-section {
            margin-top: 2rem;
        }

        .discovery-stats {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #222;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
        }

        .stat-value {
            font-weight: 600;
            color: #fff;
        }

        .stat-value.success { color: #4ade80; }
        .stat-value.primary { color: #60a5fa; }
        .stat-value.warning { color: #fbbf24; }

        .discovery-list {
            max-height: 250px;
            overflow-y: auto;
        }

        .discovery-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #222;
        }

        .discovery-item:last-child {
            border-bottom: none;
        }

        .discovery-name {
            color: #fff;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .discovery-type {
            color: #666;
            font-size: 0.8rem;
        }

        .discovery-meta {
            text-align: right;
        }

        .discovery-score {
            font-size: 0.8rem;
            color: #888;
            margin-top: 0.25rem;
        }

        .system-section {
            margin-top: 2rem;
        }

        .system-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .system-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .system-name {
            color: #e5e5e5;
            font-size: 0.9rem;
        }

        .system-desc {
            color: #666;
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .view-all-btn {
            padding: 0.4rem 0.75rem;
            background: transparent;
            border: 1px solid #333;
            border-radius: 6px;
            color: #888;
            font-size: 0.8rem;
            text-decoration: none;
            transition: all 0.2s;
        }

        .view-all-btn:hover {
            border-color: #4ade80;
            color: #4ade80;
        }

        .loading-text {
            color: #666;
            text-align: center;
            padding: 2rem;
        }

        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .discovery-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    {% include 'navbar.html' %}

    <div class="layout">
        <aside class="sidebar">
            <a href="#overview" class="sidebar-item active">
                <i class="fas fa-tachometer-alt"></i> 종합 현황
            </a>
            <a href="#meetings" class="sidebar-item">
                <i class="fas fa-users"></i> 회의 현황
            </a>
            <a href="#tasks" class="sidebar-item">
                <i class="fas fa-tasks"></i> 업무 현황
            </a>
            <a href="#metrics" class="sidebar-item">
                <i class="fas fa-chart-bar"></i> 성과 지표
            </a>
            <a href="#employees" class="sidebar-item">
                <i class="fas fa-user-tie"></i> AI 직원 현황
            </a>
            <a href="#business" class="sidebar-item">
                <i class="fas fa-briefcase"></i> 사업 계획
            </a>
            <a href="#discovery" class="sidebar-item">
                <i class="fas fa-search"></i> 사업 발굴 현황
            </a>
            <a href="/" class="sidebar-item">
                <i class="fas fa-home"></i> 메인으로
            </a>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">실시간 비즈니스 현황</h1>
                    <div class="system-status">
                        <span class="status-dot"></span>
                        <span>24/7 자동 운영 중</span>
                        <span id="currentTime"></span>
                    </div>
                </div>
                <button class="refresh-btn" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> 새로고침
                </button>
            </div>

            <section id="overview">
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-users"></i></div>
                        <div class="metric-value" id="activeMeetings">-</div>
                        <div class="metric-label">오늘 진행된 회의</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-tasks"></i></div>
                        <div class="metric-value" id="activeTasks">-</div>
                        <div class="metric-label">진행중인 업무</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="metric-value" id="dailyMetrics">-</div>
                        <div class="metric-label">오늘 업데이트된 지표</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-user-tie"></i></div>
                        <div class="metric-value" id="activeEmployees">9</div>
                        <div class="metric-label">활성 AI 직원</div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-won-sign"></i> 일별 매출 현황</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-chart-pie"></i> 업무 완료율</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="taskChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-bottom: 2rem;">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-history"></i> 최근 활동 내역</h3>
                    </div>
                    <div class="card-body">
                        <div class="activity-list" id="recentActivities">
                            <div class="loading-text">실시간 데이터 로딩 중...</div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="employees">
                <h2 class="section-title"><i class="fas fa-user-tie"></i> AI 직원 현황</h2>
                <div class="employee-grid" id="employeeCards"></div>
            </section>

            <section id="business">
                <h2 class="section-title"><i class="fas fa-briefcase"></i> 현재 사업 계획</h2>
                <div class="business-grid" id="businessPlans"></div>
            </section>

            <section id="discovery" class="discovery-section">
                <h2 class="section-title"><i class="fas fa-search"></i> 사업 발굴 현황</h2>
                <div class="discovery-stats">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-chart-bar"></i> 발굴 통계</h3>
                        </div>
                        <div class="card-body">
                            <div class="stat-item">
                                <span class="stat-label">총 발굴 사업</span>
                                <span class="stat-value" id="totalDiscovered">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">80점 이상 (우수)</span>
                                <span class="stat-value success" id="highScore">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">60-79점 (양호)</span>
                                <span class="stat-value primary" id="midScore">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">50-59점 (보통)</span>
                                <span class="stat-value warning" id="lowScore">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-chart-area"></i> 점수 분포</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 150px;">
                                <canvas id="scoreDistributionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-lightbulb"></i> 최근 발굴 사업</h3>
                        <a href="/business-discovery" class="view-all-btn">전체 보기</a>
                    </div>
                    <div class="card-body">
                        <div class="discovery-list" id="recentDiscoveries">
                            <div class="loading-text">로딩 중...</div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="system" class="system-section">
                <h2 class="section-title"><i class="fas fa-server"></i> 시스템 상태</h2>
                <div class="card">
                    <div class="card-body">
                        <div class="system-grid">
                            <div class="system-item">
                                <span class="status-indicator status-active"></span>
                                <div>
                                    <div class="system-name">자율 회의 시스템</div>
                                    <div class="system-desc">매시간 자동 발굴</div>
                                </div>
                            </div>
                            <div class="system-item">
                                <span class="status-indicator status-active"></span>
                                <div>
                                    <div class="system-name">데이터베이스 연결</div>
                                    <div class="system-desc">Koyeb PostgreSQL 정상</div>
                                </div>
                            </div>
                            <div class="system-item">
                                <span class="status-indicator status-active"></span>
                                <div>
                                    <div class="system-name">Git 동기화</div>
                                    <div class="system-desc">자동 백업 진행 중</div>
                                </div>
                            </div>
                            <div class="system-item" id="marketModeStatus">
                                <span class="status-indicator status-warning"></span>
                                <div>
                                    <div class="system-name">시장 분석</div>
                                    <div class="system-desc" id="marketModeDesc">로딩 중...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString('ko-KR');
        }
        setInterval(updateTime, 1000);
        updateTime();

        let revenueChart, taskChart, scoreDistributionChart;

        function initCharts() {
            Chart.defaults.color = '#888';
            Chart.defaults.borderColor = '#333';

            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['7일전', '6일전', '5일전', '4일전', '3일전', '2일전', '어제', '오늘'],
                    datasets: [{
                        label: '일별 매출 (만원)',
                        data: [120, 150, 180, 160, 200, 175, 190, 220],
                        borderColor: '#4ade80',
                        backgroundColor: 'rgba(74, 222, 128, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#222' } },
                        x: { grid: { color: '#222' } }
                    }
                }
            });

            const taskCtx = document.getElementById('taskChart').getContext('2d');
            taskChart = new Chart(taskCtx, {
                type: 'doughnut',
                data: {
                    labels: ['완료됨', '진행중', '대기중'],
                    datasets: [{
                        data: [65, 25, 10],
                        backgroundColor: ['#4ade80', '#60a5fa', '#fbbf24']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });

            const scoreCtx = document.getElementById('scoreDistributionChart').getContext('2d');
            scoreDistributionChart = new Chart(scoreCtx, {
                type: 'bar',
                data: {
                    labels: ['50-59점', '60-69점', '70-79점', '80-89점', '90점+'],
                    datasets: [{
                        label: '발굴 사업 수',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: ['#fbbf24', '#60a5fa', '#818cf8', '#4ade80', '#22c55e']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, ticks: { stepSize: 1 }, grid: { color: '#222' } },
                        x: { grid: { color: '#222' } }
                    }
                }
            });
        }

        function refreshData() {
            fetch('/api/dashboard-data')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('activeMeetings').textContent = data.meetings || '0';
                    document.getElementById('activeTasks').textContent = data.tasks || '0';
                    document.getElementById('dailyMetrics').textContent = data.metrics || '0';
                    updateRecentActivities(data.activities || []);
                    updateEmployeeCards(data.employees || []);
                    updateBusinessPlans(data.business_plans || []);
                })
                .catch(error => {
                    console.log('데이터 로드 실패:', error);
                    loadDummyData();
                });
        }

        function loadDummyData() {
            document.getElementById('activeMeetings').textContent = '3';
            document.getElementById('activeTasks').textContent = '8';
            document.getElementById('dailyMetrics').textContent = '12';

            const activities = [
                { time: '10:15', type: 'meeting', description: '일일 전략 회의 완료', status: 'completed' },
                { time: '10:00', type: 'task', description: '브랜드북 제작 업무 시작', status: 'in_progress' },
                { time: '09:45', type: 'metric', description: '고객 만족도 지표 업데이트', status: 'info' },
                { time: '09:30', type: 'system', description: 'AI 직원 9명 활성화', status: 'success' }
            ];
            updateRecentActivities(activities);

            const employees = [
                { name: '김창의', role: 'CCO', status: 'active', tasks: 3 },
                { name: '박실용', role: 'CPO', status: 'active', tasks: 2 },
                { name: '이글로벌', role: 'CGO', status: 'active', tasks: 1 },
                { name: '정브랜드', role: 'CBO', status: 'active', tasks: 2 }
            ];
            updateEmployeeCards(employees);

            const businessPlans = [
                { name: 'AI 비즈니스 자동화 컨설팅', status: 'approved', revenue: '200만원/월' },
                { name: '맞춤형 챗봇 개발 서비스', status: 'approved', revenue: '300만원/월' },
                { name: '데이터 분석 & 인사이트', status: 'approved', revenue: '150만원/월' }
            ];
            updateBusinessPlans(businessPlans);
        }

        function updateRecentActivities(activities) {
            const container = document.getElementById('recentActivities');
            container.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-content">
                        <strong>${activity.description}</strong>
                        <div class="activity-type">${activity.type}</div>
                    </div>
                    <div class="activity-meta">
                        <span class="badge badge-${getStatusColor(activity.status)}">${activity.status}</span>
                        <div class="activity-time">${activity.time}</div>
                    </div>
                </div>
            `).join('');
        }

        function updateEmployeeCards(employees) {
            const container = document.getElementById('employeeCards');
            container.innerHTML = employees.map(employee => `
                <div class="employee-card">
                    <div class="employee-info">
                        <h4>${employee.name}</h4>
                        <div class="employee-role">${employee.role}</div>
                    </div>
                    <div class="employee-status">
                        <span class="status-indicator status-${employee.status}"></span>
                        <div class="task-count">${employee.tasks || 0} 업무</div>
                    </div>
                </div>
            `).join('');
        }

        function updateBusinessPlans(plans) {
            const container = document.getElementById('businessPlans');
            container.innerHTML = plans.map(plan => `
                <div class="employee-card">
                    <div class="employee-info">
                        <h4>${plan.name}</h4>
                        <div class="employee-role">예상 매출: ${plan.revenue}</div>
                    </div>
                    <span class="badge badge-${getStatusColor(plan.status)}">${plan.status}</span>
                </div>
            `).join('');
        }

        function getStatusColor(status) {
            const colors = {
                'completed': 'success', 'approved': 'success',
                'in_progress': 'primary', 'active': 'success',
                'pending': 'warning', 'info': 'info', 'success': 'success'
            };
            return colors[status] || 'info';
        }

        function loadDiscoveryData() {
            fetch('/api/discovered-businesses')
                .then(response => response.json())
                .then(data => {
                    if (data.businesses) {
                        const businesses = data.businesses;
                        const highScore = businesses.filter(b => b.score >= 80).length;
                        const midScore = businesses.filter(b => b.score >= 60 && b.score < 80).length;
                        const lowScore = businesses.filter(b => b.score >= 50 && b.score < 60).length;

                        document.getElementById('totalDiscovered').textContent = businesses.length;
                        document.getElementById('highScore').textContent = highScore;
                        document.getElementById('midScore').textContent = midScore;
                        document.getElementById('lowScore').textContent = lowScore;

                        const dist = [
                            businesses.filter(b => b.score >= 50 && b.score < 60).length,
                            businesses.filter(b => b.score >= 60 && b.score < 70).length,
                            businesses.filter(b => b.score >= 70 && b.score < 80).length,
                            businesses.filter(b => b.score >= 80 && b.score < 90).length,
                            businesses.filter(b => b.score >= 90).length
                        ];
                        scoreDistributionChart.data.datasets[0].data = dist;
                        scoreDistributionChart.update();

                        updateRecentDiscoveries(businesses.slice(0, 10));
                    }
                })
                .catch(error => {
                    console.log('발굴 데이터 로드 실패:', error);
                    document.getElementById('recentDiscoveries').innerHTML =
                        '<div class="loading-text">데이터를 불러올 수 없습니다</div>';
                });
        }

        function updateRecentDiscoveries(businesses) {
            const container = document.getElementById('recentDiscoveries');
            if (!businesses.length) {
                container.innerHTML = '<div class="loading-text">발굴된 사업이 없습니다</div>';
                return;
            }

            container.innerHTML = businesses.map(biz => {
                const badgeClass = biz.score >= 80 ? 'success' : biz.score >= 60 ? 'primary' : 'warning';
                return `
                    <div class="discovery-item">
                        <div>
                            <div class="discovery-name">${biz.name}</div>
                            <div class="discovery-type">${biz.type || '-'}</div>
                        </div>
                        <div class="discovery-meta">
                            <span class="badge badge-${badgeClass}">${biz.score}점</span>
                            <div class="discovery-score">${biz.created_at || ''}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadMarketConfig() {
            fetch('/api/market-config')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.config) {
                        const isLightweight = data.config.is_lightweight;
                        const statusEl = document.getElementById('marketModeStatus');
                        const descEl = document.getElementById('marketModeDesc');

                        statusEl.querySelector('.status-indicator').className =
                            `status-indicator ${isLightweight ? 'status-warning' : 'status-active'}`;
                        descEl.textContent = isLightweight ? '경량 모드 (내부 데이터)' : '전체 모드 (실시간 API)';
                    }
                })
                .catch(error => {
                    document.getElementById('marketModeDesc').textContent = '상태 확인 불가';
                });
        }

        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            loadDummyData();
            loadDiscoveryData();
            loadMarketConfig();
            setInterval(refreshData, 30000);
            setInterval(loadDiscoveryData, 60000);
        });
    </script>
</body>
</html>
